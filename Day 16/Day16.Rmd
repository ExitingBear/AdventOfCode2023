---
title: "Day 16 Notebook"
output: html_notebook
---

```{r setup, include=FALSE}
library(knitr)
library(dplyr)
library(stringr)
library(tidyverse)
library(igraph)
library(ggplot2)
library(rgl)
library(ggraph)
library(readr)
library(ds4psy)
library(numbers)
library(collections)
options(scipen = 999)
```


## Part 1
So if you shine a light in the top left corner, pointing right - where does it go?

```{r}
input <- read_lines("Day16Sample.txt")
```

Attempting to use a dictionary rather than a data.frame to save some time:

```{r}
cd<-collections::dict()
for(i in 1:length(input)){
  for(j in 1:nchar(input[1])){
    cd$set(paste0(j,"~",i),str_sub(input[i],j,j))}}
### adding x & y max to the dictionary
cd$set("x-max",nchar(input[1]))
cd$set("y-max",length(input))
```

Create a function that takes in starting point, direction and returns all the points that light up - 
the idea here is that it doesn't have to actually follow the path, because the path itself isn't that important.  Set up a queue to decide where to go next. 



```{r}
lightlist<-function(startx=1,starty=1,d="R",c=cd){
  ### using a dictionary to hold the list of places that have been visited.
  lit <- collections::dict()
  ### both the key and the value are direction~x~y
  lit$set(paste0(d,"~",startx,"~",starty),paste0(d,"~",startx,"~",starty))
  ### starting at the top of the list
  ### find where the edges are
  collimit<-c$get("x-max")
  rowlimit<-c$get("y-max")
  explore<-collections::queue()
  explore$push(list(d,startx,starty))
  while(explore$size()>0){
    wherefrom<-explore$pop()
    dirs<-wherefrom[[1]]
    checkx<-wherefrom[[2]]
    checky<-wherefrom[[3]]
    whatami<- c$get(paste0(checkx,"~",checky))
    ### find the next direction 
    switch(dirs,
           "R"={
             switch(whatami,
                    "." =nextd<-c("R"),
                    "/" =nextd<-c("U"),
                    "\\"=nextd<-c("D"),
                    "-" =nextd<-c("R"),
                    "|" =nextd<-c("U","D"),
                    cat(cursp,whatami,"rightproblem","\n"))},
           "L"={
             switch(whatami,
                    "." =nextd<-c("L"),
                    "/" =nextd<-c("D"),
                    "\\"=nextd<-c("U"),
                    "-" =nextd<-c("L"),
                    "|" =nextd<-c("D","U"),
                    cat(cursp,whatami,"rightproblem","\n"))},
           "U"={
             switch(whatami,
                    "." =nextd<-c("U"),
                    "/" =nextd<-c("R"),
                    "\\"=nextd<-c("L"),
                    "|" =nextd<-c("U"),
                    "-" =nextd<-c("R","L"),
                    cat(cursp,whatami,"rightproblem","\n"))},
           "D"={
             switch(whatami,
                    "." =nextd<-c("D"),
                    "/" =nextd<-c("L"),
                    "\\"=nextd<-c("R"),
                    "|" =nextd<-c("D"),
                    "-" =nextd<-c("R","L"),
                    cat(cursp,whatami,"rightproblem","\n"))},
           cat("somethingwentwrong","\n"))
    ### for all nextds - figure out next x & y. figure out if we've been there (in that direction) before.
    ### if not, push to the queue & add to the list
    for(i in 1:length(nextd)){
      nd<-nextd[i]
      switch(nd,
             "R"={nextx<-checkx+1
             nexty<-checky},
             "U"={nextx<-checkx
             nexty<-checky-1},
             "L"={nextx<-checkx-1
             nexty<-checky},
             "D"={nextx<-checkx
             nexty<-checky+1},
             cat("somethingwentwrong \n"))
      combod<-paste0(nd,"~",nextx,"~",nexty)
      if(!(lit$has(combod))&&nextx>=1&&nexty>=1&&nextx<=collimit&&nexty<=rowlimit){
        lit$set(combod,combod)
        explore$push(list(nd,nextx,nexty))}}}
  ### the directions do not matter after all the list has been run through.  Only return the spaces visited

  lit<-lit$as_list()
  lit<-unique(sapply(lit,function(x){str_sub(x,3)}))
  lit}
```

And then run:

```{r}
lightedspaces <- lightlist()
part1 <- length(lightedspaces)
part1
```



```{r,echo=FALSE}
lightpoints <- data.frame(lightedspaces)
colnames(lightpoints) <- c("lightedspaces")
lightpoints <- lightpoints %>% mutate (x=as.numeric(str_split_i(lightedspaces,"~",1)),y=as.numeric(str_split_i(lightedspaces,"~",2))) %>% select(x,y)

gr<-ggplot(data=lightpoints)+
  geom_point(aes(x=x,y=y),colour="yellow",size=14,shape=15)+
  scale_y_reverse()+
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())+
  coord_fixed()


gr
```

## Part 2
Find the highest number of lights you can light from any direction (no need to know where - just how many lights)
```{r}
### create a list of all starting points, down from the top, up from the bottom, left from the right, right from the left

possiblestarts <- list()
for (j in 1:cd$get("y-max")){
  l<-list("R",1,j)
  r<-list("L",cd$get("x-max"),j)
  possiblestarts <- append(possiblestarts,list(r))
  possiblestarts <- append(possiblestarts,list(l))}

for (j in 1:cd$get("x-max")){
  u<-list("D",j,1)
  d<-list("U",j,cd$get("y-max"))
  possiblestarts <- append(possiblestarts,list(u))
  possiblestarts <- append(possiblestarts,list(d))}

```


Now run the possible starts - first check to see if I've ever been there before from this direction.  If so, don't bother, it will be less than the one already run.
```{r}
part2<-c()
for(i in 1:length(possiblestarts)){
  attempt<-possiblestarts[[i]]
    attempt<-lightlist(attempt[[2]],attempt[[3]],attempt[[1]],cd)
    part2 <- max(part2,length(attempt))}
part2
```


Single function - lightedspaces() exists.  This takes about 5 minutes to run start to finish for the real data
```{r}
day16answers <-function(contraption){
  ### part1
  part1 <- length(lightlist(1,1,"R",contraption))
  ### part 2 - get the list of starts
  
possiblestarts <- list()
for (j in 1:contraption$get("y-max")){
  l<-list("R",1,j)
  r<-list("L",contraption$get("x-max"),j)
  possiblestarts <- append(possiblestarts,list(r))
  possiblestarts <- append(possiblestarts,list(l))}

for (j in 1:contraption$get("x-max")){
  u<-list("D",j,1)
  d<-list("U",j,contraption$get("y-max"))
  possiblestarts <- append(possiblestarts,list(u))
  possiblestarts <- append(possiblestarts,list(d))}

  
  ### run through starts
part2<-0
for(i in 1:length(possiblestarts)){
  attempt<-possiblestarts[[i]]
    attempt<-lightlist(attempt[[2]],attempt[[3]],attempt[[1]],contraption)
    part2 <- max(part2,length(attempt))}
  c(part1,part2)}
```


```{r}
day16 <- day16answers(cd)
day16
```
