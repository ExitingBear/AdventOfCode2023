---
title: "Day 2 Notebook"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
library(knitr)
library(dplyr)
library(stringr)
library(tidyverse)
library(readr)

```

```{r}
# Read in data
mydata <- read_lines("Day2Sample.txt")
```

## Part 1

So - the  data that looks like this:
> Game 1: 3 blue, 4 red; 1 red, 2 green, 6 blue; 2 green

and the goal is to figure out if it's "possible" which means there's never more than 12 reds, 13 greens, and 14 blues.
So, it seems that what might work was:

1. organize the data (get rid of the words, always put it in the same order)
2. find out what the max number of reds, greens, and blues are in any game
3. figure out if that's too damn many
4. add the game numbers for the ones that are possible

### Organize the Data

First, I wanted to turn the data into a data frame - or to transform
Game 1: 3 blue, 4 red; 1 red, 2 green, 6 blue; 2 green
into


|Game|Red|Green|Blue|
|---|---|---|---|
|1|4|0|3|
|1|1|2|6|
|1|0|2|0|

So first, I want a function that changes a string like "1 red, 2 green, 6 blue" into a vector like c(1, 2, 6).  (Where I'd just know that the first is red, the second is green, and the third is blue).  Here's the function - rgb()
```{r}
rgb <- function(x){
  x<-unlist(str_split(x,","))
  i<-1
  outrgb <- c(0,0,0)
  while (i<=length(x)){
    if(grepl("red",x[i])){outrgb[1]<-parse_number(x[i])}
    if(grepl("green",x[i])){outrgb[2]<-parse_number(x[i])}
    if(grepl("blue",x[i])){outrgb[3]<-parse_number(x[i])}
    i<-i+1
  }
  outrgb
}

rgb("1 red, 2 green, 6 blue")
```

Now to reformat the data to be a list of lists

```{r}

changedata <- sapply(mydata,function(x){
  game <- as.numeric(str_split_i(str_remove(x,"Game "),": ",1))
  tries <- str_split(str_split_i(x,": ",2),"; ")
  tries <- lapply(unlist(tries),rgb)
  tries <- lapply(tries,function(x){append(game,x)})
  tries})

mydata[[1]]

changedata[[1]]
```
And make the data frame
```{r}
answerframe <- as.data.frame(matrix(ncol=4,nrow=0))

for(i in 1:length(changedata)){
  for(j in 1:length(changedata[[i]])){
    x<-changedata[[i]][[j]]
    answerframe <- rbind(answerframe,x)}}

colnames(answerframe)<-c("game","red","green","blue")

answerframe[1:min(8,nrow(answerframe)),]
```

The data is organized & usable so

### Find out what the max number of reds, greens, and blues are in any game

```{r}
answerframe <- answerframe %>% group_by(game) %>% summarise(maxred = max(red),maxgreen= max(green),maxblue=max(blue))

answerframe[1:min(8,nrow(answerframe)),]
```

### Figure out if that's too damn many

In case we need the maxes later, don't filter, just add a new column

```{r}
answerframe <- answerframe %>% mutate(possible = ifelse(maxred<=12 & maxgreen<=13 & maxblue<=14,game,0))


answerframe[1:min(8,nrow(answerframe)),]
```

### Add game numbers

Which is the sum of possible
```{r}
part1<-sum(answerframe$possible)
part1
```
## Part 2

To get "power" take the max of each color and multiply them together
```{r}
answerframe<-answerframe %>% mutate(power=maxred*maxblue*maxgreen)
part2<-sum(answerframe$power)
answerframe[1:min(8,nrow(answerframe)),]
part2
```
Or to put it all in a single function (with a helper function - rgb() above, so two functions - but you know what I mean):  


```{r}
### starts with the data already read in using read_lines()
day2answers<-function(input){
  ### reformat input into list of lists
  listdata <- sapply(input,function(x){
    game <- as.numeric(str_split_i(str_remove(x,"Game "),": ",1))
    tries <- str_split(str_split_i(x,": ",2),"; ")
    tries <- lapply(unlist(tries),rgb)
    tries <- lapply(tries,function(x){append(game,x)})
    tries})

  ### enter into a data frame
  answerframe <- as.data.frame(matrix(ncol=4,nrow=0))
  
  for(i in 1:length(listdata)){
    for(j in 1:length(listdata[[i]])){
      x<-listdata[[i]][[j]]
      answerframe <- rbind(answerframe,x)}}
  colnames(answerframe)<-c("game","red","green","blue")
  
  ### get max rgb
  answerframe <- answerframe %>% group_by(game) %>%
    summarise(maxred = max(red),maxgreen = max(green),maxblue = max(blue))
  
  ### get possible and power
  answerframe <- answerframe %>%
    mutate(possible = ifelse(maxred<=12 & maxgreen<=13 & maxblue<=14,game,0),
           power = maxred*maxgreen*maxblue)
  part1 <-sum(answerframe$possible)
  part2 <-sum(answerframe$power)
  return(c(part1,part2))}

```


```{r}
day2answers(mydata)
```

